<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Immobilien-Steuer-Suite 2025 - Ultimate Enterprise Edition Enhanced</title>

    <!-- PWA Meta Tags -->
    <meta name="theme-color" content="#3498db">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="Steuer-Suite Ultimate">
    <meta name="description" content="Ultimate Enterprise Immobiliensteuer-Optimierung 2025 mit KI, Real-time Analytics und PDF-Reports">

    <!-- SEO Meta Tags -->
    <meta name="keywords" content="Immobilien, Steuer, KI, Real-time, PDF, Enterprise, Analytics, TypeScript">
    <meta name="author" content="Immobilien-Steuer-Suite Ultimate Enhanced">
    <meta name="robots" content="index, follow">

    <!-- Favicon -->
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>🏠</text></svg>">

    <!-- Stylesheets -->
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="css/components.css">
    <link rel="stylesheet" href="css/responsive.css">

    <!-- External Libraries -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
</head>
<body>
    <!-- Skip Links for Accessibility -->
    <a href="#main-content" class="skip-link">Skip to main content</a>
    <a href="#navigation" class="skip-link">Skip to navigation</a>

    <div class="app-container">
        <!-- Enhanced Header with Performance Indicator -->
        <header class="app-header" id="app-header" role="banner">
            <div class="header-content">
                <div class="app-title">
                    <span style="font-size: 2.5rem;" role="img" aria-label="House">🏠</span>
                    <div>
                        <h1>Immobilien-Steuer-Suite 2025</h1>
                        <div class="subtitle">Ultimate Enterprise Enhanced • KI • Real-time • PDF Reports • Multi-Scenario</div>
                    </div>
                </div>
                <div class="header-actions">
                    <div class="performance-indicator" role="status" aria-live="polite">
                        <div class="performance-dot"></div>
                        <span id="performance-text">System wird geladen...</span>
                    </div>
                    <button class="btn btn-primary" onclick="app.exportPDFReport()" title="PDF-Bericht exportieren (Ctrl+P)" aria-label="PDF-Bericht exportieren">
                        📊 PDF Report
                    </button>
                    <button class="btn btn-success" onclick="app.loadExample()" title="Beispieldaten laden (Ctrl+E)" aria-label="Beispieldaten laden">
                        💡 Beispiel
                    </button>
                    <button class="btn btn-warning" onclick="app.showComparison()" title="Multi-Szenario Vergleich (Ctrl+M)" aria-label="Multi-Szenario Vergleich anzeigen">
                        📈 Vergleich
                    </button>
                    <button class="btn btn-secondary" onclick="app.resetAll()" title="Alles zurücksetzen (Ctrl+R)" aria-label="Alle Daten zurücksetzen">
                        🔄 Reset
                    </button>
                </div>
            </div>
        </header>

        <div class="main-content">
            <!-- Enhanced Sidebar with Navigation -->
            <aside class="sidebar" id="navigation" role="navigation" aria-label="Hauptnavigation">
                <nav>
                    <ul class="nav-menu" role="menubar">
                        <li class="nav-item" role="none">
                            <a href="#verkauf" class="nav-link active" data-section="verkauf" role="menuitem" aria-current="page">
                                <span class="nav-icon" role="img" aria-label="Geld">💰</span>
                                Verkaufssteuer
                                <span class="nav-badge">AI</span>
                            </a>
                        </li>
                        <li class="nav-item" role="none">
                            <a href="#grundsteuer" class="nav-link" data-section="grundsteuer" role="menuitem">
                                <span class="nav-icon" role="img" aria-label="Gebäude">🏛️</span>
                                Grundsteuer 2025
                            </a>
                        </li>
                        <li class="nav-item" role="none">
                            <a href="#erbschaft" class="nav-link" data-section="erbschaft" role="menuitem">
                                <span class="nav-icon" role="img" aria-label="Familie">👨‍👩‍👧‍👦</span>
                                Erbschaftsteuer
                            </a>
                        </li>
                        <li class="nav-item" role="none">
                            <a href="#schenkung" class="nav-link" data-section="schenkung" role="menuitem">
                                <span class="nav-icon" role="img" aria-label="Geschenk">🎁</span>
                                Schenkungssteuer
                            </a>
                        </li>
                        <li class="nav-item" role="none">
                            <a href="#cashflow" class="nav-link" data-section="cashflow" role="menuitem">
                                <span class="nav-icon" role="img" aria-label="Diagramm">📊</span>
                                Cash-Flow Analyse
                            </a>
                        </li>
                        <li class="nav-item" role="none">
                            <a href="#strategie" class="nav-link" data-section="strategie" role="menuitem">
                                <span class="nav-icon" role="img" aria-label="Ziel">🎯</span>
                                Gesamtstrategie
                            </a>
                        </li>
                        <li class="nav-item" role="none">
                            <a href="https://deka42.github.io/SteuerImmo/calculations.html" target="_blank" class="nav-link" role="menuitem">
                                <span class="nav-icon" role="img" aria-label="Rechner">🧮</span>
                                Calculations
                            </a>
                        </li>
                    </ul>
                </nav>

                <!-- Enhanced Plugin Architecture -->
                <div class="card" style="margin-top: 2rem;">
                    <div class="card-header">
                        <h3 style="font-size: 1rem;">🔌 Verfügbare Plugins</h3>
                    </div>
                    <div class="plugin-list" role="list">
                        <div class="plugin-item" onclick="app.loadPlugin('bundesland-analyzer')" role="listitem" tabindex="0">
                            <strong>🗺️ Bundesland-Analyzer</strong>
                            <small>Steuervergleich nach Bundesländern</small>
                        </div>
                        <div class="plugin-item" onclick="app.loadPlugin('inflation-calculator')" role="listitem" tabindex="0">
                            <strong>📊 Inflations-Rechner</strong>
                            <small>Berücksichtigung der Inflation</small>
                        </div>
                        <div class="plugin-item" onclick="app.loadPlugin('ai-optimizer')" role="listitem" tabindex="0">
                            <strong>🤖 KI-Optimierer</strong>
                            <small>Machine Learning Vorhersagen</small>
                        </div>
                        <div class="plugin-item" onclick="app.loadPlugin('international-tax')" role="listitem" tabindex="0">
                            <strong>🌍 International Tax</strong>
                            <small>Cross-Border Optimierung</small>
                        </div>
                    </div>
                </div>

                <!-- System Status -->
                <div class="card" style="margin-top: 1rem;">
                    <div class="card-header">
                        <h3 style="font-size: 1rem;">⚡ System Status</h3>
                    </div>
                    <div style="font-size: 0.8rem;">
                        <div style="margin-bottom: 0.5rem;">
                            <span>API Status:</span> 
                            <span id="api-status" style="color: var(--success-solid);">✅ Online</span>
                        </div>
                        <div style="margin-bottom: 0.5rem;">
                            <span>Cache:</span> 
                            <span id="cache-status" style="color: var(--success-solid);">✅ Aktiv</span>
                        </div>
                        <div style="margin-bottom: 0.5rem;">
                            <span>Fehlerrate:</span> 
                            <span id="error-rate-status">0%</span>
                        </div>
                        <div>
                            <span>Version:</span> 
                            <span style="color: var(--primary-solid);">v4.0.5-enhanced</span>
                        </div>
                    </div>
                </div>
            </aside>

            <!-- Main Content Area -->
            <main class="content-area" id="main-content" role="main">
                <!-- Content will be dynamically loaded here -->
                <div id="dynamic-content">
                    <div class="card">
                        <div class="card-header">
                            <div class="card-title">
                                <span role="img" aria-label="Laden">⏳</span>
                                <span>System wird initialisiert...</span>
                            </div>
                        </div>
                        <div class="alert alert-info">
                            <p>Die Ultimate Enterprise Tax Suite wird geladen. Bitte warten Sie einen Moment...</p>
                        </div>
                    </div>
                </div>
            </main>

            <!-- Enhanced Analytics Panel -->
            <aside class="analytics-panel" role="complementary" aria-label="Analytics und Statistiken">
                <div class="analytics-header">
                    <h3>📊 Real-time Analytics</h3>
                </div>

                <div class="analytics-widget">
                    <div class="widget-header">
                        <span class="widget-title">Performance</span>
                        <span class="widget-icon" role="img" aria-label="Blitz">⚡</span>
                    </div>
                    <div class="metric-value" id="calc-time">0ms</div>
                    <div class="metric-label">Berechnungszeit</div>
                </div>

                <div class="analytics-widget">
                    <div class="widget-header">
                        <span class="widget-title">Optimierung</span>
                        <span class="widget-icon" role="img" aria-label="Ziel">🎯</span>
                    </div>
                    <div class="metric-value" id="savings-potential">€0</div>
                    <div class="metric-label">Max. Ersparnis</div>
                </div>

                <div class="analytics-widget">
                    <div class="widget-header">
                        <span class="widget-title">Steuerquote</span>
                        <span class="widget-icon" role="img" aria-label="Diagramm ansteigend">📈</span>
                    </div>
                    <div class="metric-value" id="tax-rate">0%</div>
                    <div class="metric-label">Effektive Belastung</div>
                    <div class="chart-container">
                        <canvas id="tax-chart" width="200" height="100" aria-label="Steuervergleichsdiagramm"></canvas>
                    </div>
                </div>

                <div class="analytics-widget">
                    <div class="widget-header">
                        <span class="widget-title">Session</span>
                        <span class="widget-icon" role="img" aria-label="Statistiken">📊</span>
                    </div>
                    <div style="font-size: 0.9rem; color: #6c757d;" id="session-stats">
                        <div>Berechnungen: <span id="calc-count">0</span></div>
                        <div>Cache Hits: <span id="cache-hits">0</span></div>
                        <div>Fehlerrate: <span id="error-rate">0%</span></div>
                        <div>Laufzeit: <span id="uptime">0min</span></div>
                    </div>
                </div>

                <!-- Enhanced API Documentation -->
                <div class="analytics-widget">
                    <div class="widget-header">
                        <span class="widget-title">API Docs</span>
                        <span class="widget-icon" role="img" aria-label="Bücher">📚</span>
                    </div>
                    <div style="font-size: 0.8rem;">
                        <div><code>POST /api/calculate</code></div>
                        <div><code>GET /api/structures</code></div>
                        <div><code>POST /api/compare</code></div>
                        <div><code>GET /api/health</code></div>
                        <button class="btn btn-outline" onclick="app.showAPIDocumentation()" style="margin-top: 0.5rem; padding: 0.25rem 0.5rem; font-size: 0.7rem;" aria-label="Vollständige API-Dokumentation anzeigen">
                            📖 Vollständige Docs
                        </button>
                    </div>
                </div>

                <!-- Error Log Widget -->
                <div class="analytics-widget">
                    <div class="widget-header">
                        <span class="widget-title">Error Log</span>
                        <span class="widget-icon" role="img" aria-label="Warnung">⚠️</span>
                    </div>
                    <div id="error-log" style="font-size: 0.8rem; max-height: 150px; overflow-y: auto;">
                        <div style="color: var(--success-solid);">✅ Keine Fehler</div>
                    </div>
                </div>
            </aside>
        </div>

        <!-- Keyboard Shortcuts Indicator -->
        <div class="shortcut-indicator" id="shortcut-indicator" role="status" aria-live="polite"></div>

        <!-- Enhanced Undo/Redo Controls -->
        <div class="history-controls">
            <button class="history-btn" id="undo-btn" onclick="app.undo()" title="Rückgängig (Ctrl+Z)" disabled aria-label="Rückgängig machen">
                ↶
            </button>
            <button class="history-btn" id="redo-btn" onclick="app.redo()" title="Wiederholen (Ctrl+Y)" disabled aria-label="Wiederholen">
                ↷
            </button>
        </div>

        <!-- Toast Container -->
        <div class="toast-container" id="toast-container" role="status" aria-live="polite"></div>

        <!-- Enhanced Progress Overlay -->
        <div class="progress-overlay" id="progress-overlay" role="dialog" aria-modal="true" aria-labelledby="progress-title">
            <div class="progress-modal">
                <div class="spinner" role="img" aria-label="Laden"></div>
                <h3 id="progress-title">Berechnung läuft...</h3>
                <div class="progress-bar" role="progressbar" aria-valuemin="0" aria-valuemax="100" aria-valuenow="0">
                    <div class="progress-fill" id="progress-fill"></div>
                </div>
                <p id="progress-text">KI-Algorithmus analysiert optimale Steuerstrukturen...</p>
                <button class="btn btn-secondary" onclick="app.cancelCalculation()" style="margin-top: 1rem;" aria-label="Berechnung abbrechen">
                    Abbrechen
                </button>
            </div>
        </div>

        <!-- Enhanced Modal Overlays -->
        <div class="modal-overlay" id="comparison-modal" role="dialog" aria-modal="true" aria-labelledby="comparison-title">
            <div class="modal" style="max-width: 1200px;">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem;">
                    <h2 id="comparison-title">📈 Multi-Szenario Vergleich</h2>
                    <button onclick="app.closeModal('comparison-modal')" style="background: none; border: none; font-size: 2rem; cursor: pointer;" aria-label="Modal schließen">×</button>
                </div>
                <div id="comparison-content">
                    <!-- Comparison table will be generated here -->
                </div>
            </div>
        </div>

        <div class="modal-overlay" id="api-docs-modal" role="dialog" aria-modal="true" aria-labelledby="api-docs-title">
            <div class="modal" style="max-width: 800px;">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem;">
                    <h2 id="api-docs-title">📚 API Dokumentation</h2>
                    <button onclick="app.closeModal('api-docs-modal')" style="background: none; border: none; font-size: 2rem; cursor: pointer;" aria-label="Modal schließen">×</button>
                </div>
                <div id="api-docs-content">
                    <h3>Immobilien-Steuer-Suite API v4.0 Enhanced</h3>
                    <div class="alert alert-info">
                        <p><strong>Base URL:</strong> <code>https://api.steuer-suite.de/v4/</code></p>
                        <p><strong>Authentication:</strong> Bearer Token erforderlich</p>
                    </div>
                    <pre style="background: #f8f9fa; padding: 1rem; border-radius: 8px; overflow-x: auto;">
<strong>POST /api/v4/calculate</strong>
{
  "type": "verkauf",
  "data": {
    "kaufpreis": 400000,
    "verkaufspreis": 600000,
    "haltedauer": 8,
    "steuersatz": 42,
    "bundesland": "nw"
  }
}

<strong>Response:</strong>
{
  "success": true,
  "structures": […],
  "optimal": {…},
  "savings": 45000,
  "calculationTime": "45ms",
  "cacheHit": false
}

<strong>GET /api/v4/health</strong>
Response: {"status": "ok", "version": "4.0.0", "uptime": 123456}

<strong>POST /api/v4/compare</strong>
Compare multiple scenarios

<strong>GET /api/v4/plugins</strong>
List available plugins
                    </pre>
                </div>
            </div>
        </div>

        <!-- Error Details Modal -->
        <div class="modal-overlay" id="error-details-modal" role="dialog" aria-modal="true" aria-labelledby="error-details-title">
            <div class="modal" style="max-width: 600px;">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem;">
                    <h2 id="error-details-title">⚠️ Fehlerdetails</h2>
                    <button onclick="app.closeModal('error-details-modal')" style="background: none; border: none; font-size: 2rem; cursor: pointer;" aria-label="Modal schließen">×</button>
                </div>
                <div id="error-details-content">
                    <!-- Error details will be displayed here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Google Analytics 4 (GA4) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=GA_MEASUREMENT_ID"></script>
    <script src="js/analytics.js"></script>

    <!-- Google Tag Manager (Optional for advanced tracking) -->
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
    new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
    j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
    'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
    })(window,document,'script','dataLayer','GTM-XXXXXXX');</script>

    <!-- Enhanced JavaScript Classes -->
    <script src="js/classes/GoogleAnalyticsTracker.js"></script>
    <script src="js/classes/CookieConsentManager.js"></script>
    <script src="js/classes/EnhancedErrorHandler.js"></script>
    <script src="js/classes/EnhancedPDFExporter.js"></script>
    <script src="js/classes/ApplicationState.js"></script>
    <script src="js/classes/TaxCalculationEngine.js"></script>
    <script src="js/classes/UltimateImmobilienSuiteEnhanced.js"></script>

    <!-- Main Application -->
    <script src="js/app.js"></script>
</body>
</html>
