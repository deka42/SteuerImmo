<!DOCTYPE html>

<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Immobilien Steuervergleich</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

```
    body {
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        min-height: 100vh;
        padding: 20px;
    }

    .container {
        max-width: 1400px;
        margin: 0 auto;
        background: white;
        border-radius: 20px;
        box-shadow: 0 20px 40px rgba(0,0,0,0.1);
        overflow: hidden;
    }

    .header {
        background: linear-gradient(135deg, #2c3e50 0%, #3498db 100%);
        color: white;
        padding: 30px;
        text-align: center;
    }

    .header h1 {
        font-size: 2.5em;
        margin-bottom: 10px;
        font-weight: 300;
    }

    .subtitle {
        font-size: 1.2em;
        opacity: 0.9;
    }

    .main-content {
        display: grid;
        grid-template-columns: 400px 1fr;
        min-height: 600px;
    }

    .input-section {
        background: #f8f9fa;
        padding: 30px;
        border-right: 2px solid #e9ecef;
    }

    .results-section {
        padding: 30px;
    }

    .input-group {
        margin-bottom: 25px;
    }

    .input-group label {
        display: block;
        margin-bottom: 8px;
        font-weight: 600;
        color: #2c3e50;
        font-size: 0.95em;
    }

    .input-group input, .input-group select {
        width: 100%;
        padding: 12px 15px;
        border: 2px solid #e9ecef;
        border-radius: 10px;
        font-size: 16px;
        transition: all 0.3s ease;
    }

    .input-group input:focus, .input-group select:focus {
        outline: none;
        border-color: #3498db;
        box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.1);
    }

    .calculate-btn {
        width: 100%;
        padding: 15px;
        background: linear-gradient(135deg, #27ae60 0%, #2ecc71 100%);
        color: white;
        border: none;
        border-radius: 10px;
        font-size: 18px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s ease;
        margin-top: 20px;
    }

    .calculate-btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 10px 20px rgba(39, 174, 96, 0.3);
    }

    .results-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
        gap: 25px;
        margin-top: 20px;
    }

    .result-card {
        background: linear-gradient(135deg, #ffffff 0%, #f8f9fa 100%);
        border-radius: 15px;
        padding: 25px;
        border: 2px solid #e9ecef;
        transition: all 0.3s ease;
    }

    .result-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 15px 30px rgba(0,0,0,0.1);
        border-color: #3498db;
    }

    .result-card h3 {
        color: #2c3e50;
        margin-bottom: 20px;
        text-align: center;
        font-size: 1.4em;
        font-weight: 600;
    }

    .result-item {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 12px 0;
        border-bottom: 1px solid #e9ecef;
    }

    .result-item:last-child {
        border-bottom: none;
        font-weight: 600;
        font-size: 1.1em;
        margin-top: 10px;
        padding-top: 20px;
        border-top: 2px solid #3498db;
    }

    .result-label {
        color: #2c3e50;
        font-weight: 500;
    }

    .result-value {
        font-weight: 600;
        color: #27ae60;
    }

    .result-value.negative {
        color: #e74c3c;
    }

    .warning {
        background: #fff3cd;
        border: 1px solid #ffeaa7;
        color: #856404;
        padding: 15px;
        border-radius: 10px;
        margin-bottom: 20px;
        font-size: 0.9em;
    }

    .comparison-table {
        width: 100%;
        margin-top: 30px;
        border-collapse: collapse;
        background: white;
        border-radius: 10px;
        overflow: hidden;
        box-shadow: 0 5px 15px rgba(0,0,0,0.08);
    }

    .comparison-table th,
    .comparison-table td {
        padding: 15px;
        text-align: left;
        border-bottom: 1px solid #e9ecef;
        font-size: 0.9em;
    }

    .comparison-table th {
        background: #3498db;
        color: white;
        font-weight: 600;
        text-align: center;
    }

    .comparison-table tr:hover {
        background: #f8f9fa;
    }

    .best-option {
        background: #d4edda !important;
        border-left: 4px solid #27ae60;
    }

    @media (max-width: 1200px) {
        .main-content {
            grid-template-columns: 1fr;
        }
        
        .input-section {
            border-right: none;
            border-bottom: 2px solid #e9ecef;
        }
    }

    /* Kommentarsektion Styles */
    .comments-section {
        background: #f8f9fa;
        border-top: 3px solid #3498db;
        padding: 40px;
        margin-top: 0;
    }

    .comments-header {
        text-align: center;
        margin-bottom: 40px;
    }

    .comments-header h2 {
        color: #2c3e50;
        font-size: 2em;
        margin-bottom: 10px;
        font-weight: 600;
    }

    .comments-header p {
        color: #6c757d;
        font-size: 1.1em;
    }

    .comment-form {
        background: white;
        border-radius: 15px;
        padding: 30px;
        margin-bottom: 40px;
        box-shadow: 0 5px 15px rgba(0,0,0,0.08);
    }

    .comment-form h3 {
        color: #2c3e50;
        margin-bottom: 20px;
        font-size: 1.3em;
    }

    .form-group {
        margin-bottom: 20px;
        position: relative;
    }

    .form-group input,
    .form-group textarea {
        width: 100%;
        padding: 15px;
        border: 2px solid #e9ecef;
        border-radius: 10px;
        font-size: 16px;
        font-family: inherit;
        transition: all 0.3s ease;
    }

    .form-group input:focus,
    .form-group textarea:focus {
        outline: none;
        border-color: #3498db;
        box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.1);
    }

    .char-counter {
        position: absolute;
        bottom: 10px;
        right: 15px;
        font-size: 0.8em;
        color: #6c757d;
    }

    .submit-comment-btn {
        background: linear-gradient(135deg, #3498db 0%, #2980b9 100%);
        color: white;
        border: none;
        padding: 15px 30px;
        border-radius: 10px;
        font-size: 16px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s ease;
    }

    .submit-comment-btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 10px 20px rgba(52, 152, 219, 0.3);
    }

    .comments-count {
        font-size: 1.2em;
        font-weight: 600;
        color: #2c3e50;
        margin-bottom: 30px;
        text-align: center;
    }

    .comment,
    .reply {
        background: white;
        border-radius: 15px;
        padding: 25px;
        margin-bottom: 20px;
        box-shadow: 0 5px 15px rgba(0,0,0,0.08);
        transition: all 0.3s ease;
    }

    .comment:hover {
        transform: translateY(-2px);
        box-shadow: 0 10px 25px rgba(0,0,0,0.12);
    }

    .reply {
        margin-left: 40px;
        margin-top: 15px;
        background: #f8f9fa;
        border-left: 4px solid #3498db;
    }

    .comment-header {
        display: flex;
        align-items: center;
        margin-bottom: 15px;
    }

    .comment-avatar {
        width: 50px;
        height: 50px;
        border-radius: 50%;
        background: linear-gradient(135deg, #3498db 0%, #2980b9 100%);
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1.5em;
        margin-right: 15px;
    }

    .comment-meta {
        display: flex;
        flex-direction: column;
    }

    .comment-author {
        color: #2c3e50;
        font-size: 1.1em;
    }

    .comment-date {
        color: #6c757d;
        font-size: 0.9em;
        margin-top: 2px;
    }

    .comment-content {
        color: #2c3e50;
        line-height: 1.6;
        margin-bottom: 15px;
        font-size: 1em;
    }

    .comment-actions {
        display: flex;
        gap: 15px;
        align-items: center;
    }

    .like-btn,
    .dislike-btn,
    .reply-btn {
        background: none;
        border: 2px solid #e9ecef;
        border-radius: 20px;
        padding: 8px 15px;
        font-size: 0.9em;
        cursor: pointer;
        transition: all 0.3s ease;
        display: flex;
        align-items: center;
        gap: 5px;
    }

    .like-btn:hover {
        border-color: #27ae60;
        background: #27ae60;
        color: white;
    }

    .like-btn.active {
        background: #27ae60;
        border-color: #27ae60;
        color: white;
    }

    .dislike-btn:hover {
        border-color: #e74c3c;
        background: #e74c3c;
        color: white;
    }

    .dislike-btn.active {
        background: #e74c3c;
        border-color: #e74c3c;
        color: white;
    }

    .reply-btn:hover {
        border-color: #3498db;
        background: #3498db;
        color: white;
    }

    .replies {
        margin-top: 20px;
    }

    .reply-form {
        margin: 20px 0 20px 40px;
        background: #f8f9fa;
        padding: 20px;
        border-radius: 10px;
        display: none;
    }

    .reply-form.active {
        display: block;
    }

    .reply-form input,
    .reply-form textarea {
        width: 100%;
        padding: 10px;
        border: 1px solid #dee2e6;
        border-radius: 8px;
        margin-bottom: 10px;
        font-family: inherit;
    }

    .reply-form button {
        background: #3498db;
        color: white;
        border: none;
        padding: 10px 20px;
        border-radius: 8px;
        cursor: pointer;
        margin-right: 10px;
    }

    .reply-form .cancel-btn {
        background: #6c757d;
    }

    @media (max-width: 768px) {
        .results-grid {
            grid-template-columns: 1fr;
        }
        
        .header h1 {
            font-size: 2em;
        }
        
        .container {
            margin: 10px;
            border-radius: 15px;
        }

        .comments-section {
            padding: 20px;
        }

        .comment-form {
            padding: 20px;
        }

        .reply {
            margin-left: 20px;
        }

        .reply-form {
            margin-left: 20px;
        }

        .comment-actions {
            flex-wrap: wrap;
        }
    }
</style>
```

</head>
<body>
    <div class="container">
        <div class="header">
            <h1>🏠 Immobilien Steuervergleich</h1>
            <div class="subtitle">Vergleich des VERKAUFS durch verschiedene Strukturen (nicht Einbringung)</div>
        </div>

```
    <div class="main-content">
        <div class="input-section">
            <div class="warning">
                ⚠️ Hinweis: Diese Berechnung dient nur zur groben Orientierung. Für steuerliche Beratung konsultieren Sie einen Steuerberater.
            </div>
            
            <div class="warning" style="background: #ffebee; border-color: #ffcdd2; color: #c62828;">
                🚨 <strong>Steuerfreiheit richtig verstehen - Einbringung vs. Verkauf:</strong>
                <br><br><strong>§ 23 EStG (10-Jahres-Frist) für private Veräußerungsgeschäfte:</strong>
                <br>• <strong>Privatpersonen:</strong> Steuerfrei nach 10 Jahren
                <br>• <strong>Vermögensverwaltende Personengesellschaften:</strong> Transparente Besteuerung (§ 39 Abs. 2 Nr. 2 AO)
                <br><br><strong>Einbringung in GmbH/UG:</strong>
                <br>• <strong>Nach 10 Jahren Privatbesitz:</strong> Einbringung kann steuerfrei sein
                <br>• <strong>Unter 10 Jahren:</strong> Einbringung steuerpflichtig
                <br><br><strong>Verkauf durch GmbH/UG:</strong>
                <br>• <strong>Immer steuerpflichtig:</strong> ~48-50% Gesamtbelastung
                <br>• <strong>§ 23 EStG gilt nicht:</strong> Immobilie ist Betriebsvermögen
                <br>• <strong>§ 8b KStG gilt nicht:</strong> Nur für Anteile an anderen Gesellschaften
            </div>

            <div class="warning" style="background: #e3f2fd; border-color: #bbdefb; color: #1565c0; margin-top: 20px;">
                💡 <strong>Strategische Empfehlung für Immobilieninvestoren (Update 2025):</strong>
                <br><br><strong>🥇 OPTIMAL (nach Haltedauer):</strong>
                <br>• <strong>0-10 Jahre:</strong> VV GmbH & Co. KG (transparente Besteuerung + Gewerbesteueranrechnung)
                <br>• <strong>Ab 10 Jahren:</strong> Privatverkauf oder VV GbR (0% Steuern)
                <br>• <strong>Langfristig:</strong> VV GmbH & Co. KG (nach 10 Jahren steuerfrei + BFH-Gewerbesteuerbefreiung!)
                <br><br><strong>🚫 VERMEIDEN bei Immobilien:</strong>
                <br>• <strong>Reine GmbH/UG:</strong> Immer ~48-50% Steuerbelastung
                <br>• <strong>Gewerbliche Strukturen:</strong> Keine 10-Jahres-Steuerfreiheit
                <br><br><strong>⚡ Der Game-Changer:</strong> VV GmbH & Co. KG kombiniert Steuerfreiheit nach 10 Jahren mit Haftungsbegrenzung!
                <br><br><strong>🆕 WICHTIGE NEUERUNGEN 2024/2025:</strong>
                <br>• <strong>BFH-Urteil:</strong> "Aufwärts abgefärbte" VV Personengesellschaften sind gewerbesteuerfrei!
                <br>• <strong>Gesellschafterdarlehen:</strong> Steuerrechtlich nicht mehr anerkannt (BFH I R 21/22)
                <br>• <strong>Finanzierung:</strong> Kapitalkonto oder externe Finanzierung erforderlich
            </div>

            <div class="input-group">
                <label for="kaufpreis">Kaufpreis (€)</label>
                <input type="number" id="kaufpreis" value="300000" min="0">
            </div>

            <div class="input-group">
                <label for="verkaufspreis">Verkaufspreis (€)</label>
                <input type="number" id="verkaufspreis" value="450000" min="0">
            </div>

            <div class="input-group">
                <label for="nebenkosten_kauf">Nebenkosten Kauf (€)</label>
                <input type="number" id="nebenkosten_kauf" value="30000" min="0">
            </div>

            <div class="input-group">
                <label for="nebenkosten_verkauf">Nebenkosten Verkauf (€)</label>
                <input type="number" id="nebenkosten_verkauf" value="22500" min="0">
            </div>

            <div class="input-group">
                <label for="modernisierung">Modernisierung/Renovierung (€)</label>
                <input type="number" id="modernisierung" value="50000" min="0">
            </div>

            <div class="input-group">
                <label for="haltedauer">Haltedauer (Jahre)</label>
                <input type="number" id="haltedauer" value="8" min="0">
            </div>

            <div class="input-group">
                <label for="einbringung_nach_jahren">Ursprünglich private Haltedauer vor Einbringung (Jahre) - optional</label>
                <input type="number" id="einbringung_nach_jahren" placeholder="z.B. 3 = 3 Jahre privat, dann eingebracht" min="0">
                <small style="color: #6c757d; font-size: 0.8em;">
                    <strong>Beispiel:</strong> 12 Jahre private Haltung → Einbringung steuerfrei (§23 EStG). Verkauf durch GmbH dennoch steuerpflichtig!
                </small>
            </div>

            <div class="input-group">
                <label for="persoenlicher_steuersatz">Persönlicher Steuersatz (%)</label>
                <input type="number" id="persoenlicher_steuersatz" value="42" min="0" max="47" step="0.1">
            </div>

            <div class="input-group">
                <label for="kirchensteuer">Kirchensteuer (%)</label>
                <input type="number" id="kirchensteuer" value="8" min="0" max="9" step="0.1">
            </div>

            <button class="calculate-btn" onclick="berechnen()">📊 Berechnung durchführen</button>
        </div>

        <div class="results-section">
            <div id="results-container">
                <h2 style="text-align: center; color: #2c3e50; margin-bottom: 30px;">Ergebnisse der Steuerberechnung</h2>
                <div class="results-grid" id="results-grid">
                    <!-- Ergebnisse werden hier eingefügt -->
                </div>
                <table class="comparison-table" id="comparison-table" style="display: none;">
                    <thead>
                        <tr>
                            <th>Struktur</th>
                            <th>Nettogewinn</th>
                            <th>Steuern</th>
                            <th>Steuerquote</th>
                            <th>Besonderheiten</th>
                        </tr>
                    </thead>
                    <tbody id="comparison-body">
                        <!-- Vergleichstabelle wird hier eingefügt -->
                    </tbody>
                </table>
                
                <div class="warning" style="background: #e8f5e8; border-color: #c8e6c9; color: #2e7d32; margin-top: 30px;">
                    🏆 <strong>VV GmbH & Co. KG vs. Reine GmbH - Der entscheidende Unterschied (Update 2025):</strong>
                    <br><br><strong>VV GmbH & Co. KG (Personengesellschaft):</strong>
                    <br>• ✅ <strong>Nach 10 Jahren STEUERFREI</strong> (§23 EStG gilt)
                    <br>• ✅ <strong>BFH 2025: GEWERBESTEUERFREI</strong> als "aufwärts abgefärbte" Struktur
                    <br>• ✅ <strong>Transparente Besteuerung</strong> - keine Doppelbesteuerung
                    <br>• ✅ <strong>Verluste sofort verrechenbar</strong> mit anderen Einkünften
                    <br>• ✅ <strong>Flexible Gewinnverteilung</strong> möglich
                    <br>• ⚠️ <strong>Finanzierung über Kapitalkonto</strong> (keine Gesellschafterdarlehen mehr)
                    <br><br><strong>Reine VV GmbH (Kapitalgesellschaft):</strong>
                    <br>• ❌ <strong>NIEMALS steuerfrei</strong> bei Immobilienverkäufen
                    <br>• ❌ <strong>Doppelbesteuerung:</strong> ~30% GmbH + ~26% Ausschüttung = ~48-50%
                    <br>• ❌ <strong>Verluste "gefangen"</strong> in der Gesellschaft
                    <br>• ❌ <strong>Starre Gewinnverteilung</strong> nach Beteiligungsquoten
                    <br>• ⚠️ <strong>Gesellschafterdarlehen möglich</strong> (aber Doppelbesteuerung bleibt)
                    <br><br><strong>🎯 Bei 150.000€ Gewinn nach 10+ Jahren:</strong>
                    <br>• <strong>GmbH & Co. KG:</strong> 0€ Steuern = 150.000€ netto
                    <br>• <strong>Reine GmbH:</strong> ~72.000€ Steuern = ~78.000€ netto
                    <br>• <strong>💰 Vorteil GmbH & Co. KG: 72.000€ gespart + gewerbesteuerfrei!</strong>
                </div>

                <div class="warning" style="background: #fff3cd; border-color: #ffeaa7; color: #856404; margin-top: 20px;">
                    📋 <strong>Differenzierte Betrachtung der Einbringung und des Verkaufs:</strong>
                    <br><br><strong>1. Einbringung von PRIVATVERMÖGEN in GmbH:</strong>
                    <br>• <strong>Nach 10 Jahren:</strong> Einbringung kann steuerfrei sein (§ 23 EStG)
                    <br>• <strong>Unter 10 Jahren:</strong> Einbringung steuerpflichtig (Veräußerungsgewinn)
                    <br>• <strong>Nach Einbringung:</strong> Immobilie wird Betriebsvermögen der GmbH
                    <br><br><strong>2. Einbringung von BETRIEBSVERMÖGEN in GmbH:</strong>
                    <br>• <strong>§ 20 UmwStG:</strong> Steuerneutrale Einbringung möglich (Buchwertfortführung)
                    <br>• <strong>Steueraufschiebung</strong> - nicht Steuerbefreiung
                    <br>• <strong>Thesaurierungspflicht</strong> unter bestimmten Voraussetzungen
                    <br><br><strong>3. Verkauf DURCH die GmbH (nach Einbringung):</strong>
                    <br>• <strong>Immer steuerpflichtig:</strong> ~30% Gesellschaft + ~26% Ausschüttung = ~48-50%
                    <br>• <strong>Keine Steuerfreiheit:</strong> § 23 EStG und § 8b KStG gelten nicht
                    <br>• <strong>Betriebsvermögen:</strong> Keine privaten Veräußerungsgeschäfte mehr
                    <br><br><strong>🚨 NEU 2024/2025 - Gesellschafterdarlehen:</strong>
                    <br>• <strong>BFH-Urteil (I R 21/22):</strong> Gesellschafterdarlehen an GbRs steuerrechtlich nicht anerkannt
                    <br>• <strong>Konfusion:</strong> Gläubiger = Schuldner → Forderung erlischt steuerrechtlich
                    <br>• <strong>Alternative:</strong> Kapitalkonto-Finanzierung oder externe Gesellschafter
                    <br><br><strong>⚠️ Zusätzlich zu beachten:</strong>
                    <br>• <strong>Grunderwerbsteuer</strong> bei Einbringung (Ausnahmen möglich)
                    <br>• <strong>Umsatzsteuer</strong> bei gewerblicher Vermietung
                    <br>• <strong>Drei-Objekt-Grenze:</strong> Einzelfallwürdigung seit 2024 verstärkt
                </div>
            </div>
        </div>
    </div>
    
    <!-- Kommentarsektion -->
    <div class="comments-section">
        <div class="comments-header">
            <h2>💬 Kommentare & Erfahrungen</h2>
            <p>Teilen Sie Ihre Erfahrungen oder stellen Sie Fragen zu diesem Steuervergleich</p>
        </div>
        
        <div class="comment-form">
            <h3>Neuen Kommentar hinzufügen</h3>
            <div class="form-group">
                <input type="text" id="author-name" placeholder="Ihr Name" maxlength="50">
            </div>
            <div class="form-group">
                <textarea id="comment-text" placeholder="Ihr Kommentar..." rows="4" maxlength="1000"></textarea>
                <div class="char-counter">
                    <span id="char-count">0</span>/1000
                </div>
            </div>
            <button id="submit-comment" class="submit-comment-btn">
                📝 Kommentar veröffentlichen
            </button>
        </div>
        
        <div class="comments-list" id="comments-list">
            <div class="comments-count">
                <span id="comment-count">3</span> Kommentare
            </div>
            
            <!-- Beispielkommentare -->
            <div class="comment" data-id="1">
                <div class="comment-header">
                    <div class="comment-avatar">👤</div>
                    <div class="comment-meta">
                        <strong class="comment-author">Max Immobilien</strong>
                        <span class="comment-date">vor 2 Tagen</span>
                    </div>
                </div>
                <div class="comment-content">
                    Sehr hilfreiches Tool! Die Unterscheidung zwischen Einbringung und Verkauf war mir so nicht bewusst. Besonders der Hinweis zur VV GmbH & Co. KG ist wertvoll. Hat mir bei der Entscheidung für meine Immobilienstrategie geholfen.
                </div>
                <div class="comment-actions">
                    <button class="like-btn" data-likes="12">
                        👍 <span>12</span>
                    </button>
                    <button class="dislike-btn" data-dislikes="1">
                        👎 <span>1</span>
                    </button>
                    <button class="reply-btn">💬 Antworten</button>
                </div>
                
                <div class="replies">
                    <div class="reply" data-id="1-1">
                        <div class="comment-header">
                            <div class="comment-avatar">👩‍💼</div>
                            <div class="comment-meta">
                                <strong class="comment-author">Steuerberaterin Sarah</strong>
                                <span class="comment-date">vor 1 Tag</span>
                            </div>
                        </div>
                        <div class="comment-content">
                            @Max Immobilien Genau richtig erkannt! Die BFH-Urteile von 2024/2025 haben hier einiges geändert. Wichtig ist auch die neue Rechtsprechung zu Gesellschafterdarlehen.
                        </div>
                        <div class="comment-actions">
                            <button class="like-btn" data-likes="8">
                                👍 <span>8</span>
                            </button>
                            <button class="dislike-btn" data-dislikes="0">
                                👎 <span>0</span>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="comment" data-id="2">
                <div class="comment-header">
                    <div class="comment-avatar">🏠</div>
                    <div class="comment-meta">
                        <strong class="comment-author">Investor_2024</strong>
                        <span class="comment-date">vor 5 Tagen</span>
                    </div>
                </div>
                <div class="comment-content">
                    Eine Frage zur Berechnung: Werden auch die neuen Regelungen zur Grundsteuer berücksichtigt? Und wie sieht es mit der Erbschaftsteuer bei Übertragung aus?
                </div>
                <div class="comment-actions">
                    <button class="like-btn" data-likes="5">
                        👍 <span>5</span>
                    </button>
                    <button class="dislike-btn" data-dislikes="2">
                        👎 <span>2</span>
                    </button>
                    <button class="reply-btn">💬 Antworten</button>
                </div>
            </div>
            
            <div class="comment" data-id="3">
                <div class="comment-header">
                    <div class="comment-avatar">⚖️</div>
                    <div class="comment-meta">
                        <strong class="comment-author">Rechtsanwalt Weber</strong>
                        <span class="comment-date">vor 1 Woche</span>
                    </div>
                </div>
                <div class="comment-content">
                    Wichtiger Hinweis zum Tool: Bei der Drei-Objekt-Grenze gibt es seit 2024 verschärfte Prüfungen durch die Finanzämter. Jeder Fall wird einzeln betrachtet. Das Tool ist aber eine super Orientierungshilfe für erste Kalkulationen.
                </div>
                <div class="comment-actions">
                    <button class="like-btn" data-likes="18">
                        👍 <span>18</span>
                    </button>
                    <button class="dislike-btn" data-dislikes="0">
                        👎 <span>0</span>
                    </button>
                    <button class="reply-btn">💬 Antworten</button>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Firebase SDK -->
<script type="module">
    // Firebase Configuration (Ersetzen Sie mit Ihrer eigenen Config)
    import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
    import { 
        getFirestore, 
        collection, 
        addDoc, 
        getDocs, 
        doc, 
        updateDoc, 
        orderBy, 
        query, 
        serverTimestamp 
    } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js';

    // Firebase Configuration - Aktiviert für dauerhafte Kommentarspeicherung
    const firebaseConfig = {
        apiKey: "AIzaSyDKZpE30GmsZNhN28d2nT0SnyI_cN5esNE",
        authDomain: "steuervergleich-kommentare.firebaseapp.com",
        databaseURL: "https://steuervergleich-kommentare-default-rtdb.europe-west1.firebasedatabase.app",
        projectId: "steuervergleich-kommentare",
        storageBucket: "steuervergleich-kommentare.firebasestorage.app",
        messagingSenderId: "524534192125",
        appId: "1:524534192125:web:9282205e4a3878b7696b94",
        measurementId: "G-Y3NNN5KVX5"
    };

    let app, db;
    let firebaseInitialized = false;

    // Firebase initialisieren (falls korrekte Config vorhanden)
    try {
        // Firebase automatisch mit der Konfiguration initialisieren
        app = initializeApp(firebaseConfig);
        db = getFirestore(app);
        firebaseInitialized = true;
        console.log("✅ Firebase erfolgreich initialisiert - Kommentare werden global gespeichert");
    } catch (error) {
        console.error("❌ Firebase Initialisierung fehlgeschlagen:", error);
        console.warn("🔄 Fallback: Verwende lokalen Speicher");
        firebaseInitialized = false;
    }

    // Firebase Funktionen
    async function loadCommentsFromFirebase() {
        if (!firebaseInitialized) return [];
        
        try {
            showLoading(true);
            const q = query(collection(db, "kommentare"), orderBy("timestamp", "desc"));
            const querySnapshot = await getDocs(q);
            const comments = [];
            
            querySnapshot.forEach((doc) => {
                const data = doc.data();
                comments.push({
                    id: doc.id,
                    author: data.author,
                    content: data.content,
                    date: formatDate(data.timestamp),
                    likes: data.likes || 0,
                    dislikes: data.dislikes || 0,
                    avatar: data.avatar,
                    replies: data.replies || []
                });
            });
            
            showLoading(false);
            return comments;
        } catch (error) {
            console.error("Fehler beim Laden der Kommentare:", error);
            showNotification("❌ Fehler beim Laden der Kommentare", "error");
            showLoading(false);
            return getDefaultComments(); // Fallback zu lokalen Kommentaren
        }
    }

    async function saveCommentToFirebase(comment) {
        if (!firebaseInitialized) {
            // Lokaler Fallback
            return saveCommentLocally(comment);
        }
        
        try {
            const docRef = await addDoc(collection(db, "kommentare"), {
                author: comment.author,
                content: comment.content,
                timestamp: serverTimestamp(),
                likes: 0,
                dislikes: 0,
                avatar: comment.avatar,
                replies: []
            });
            
            return docRef.id;
        } catch (error) {
            console.error("Fehler beim Speichern:", error);
            showNotification("❌ Fehler beim Speichern des Kommentars", "error");
            throw error;
        }
    }

    async function updateCommentInFirebase(commentId, updates) {
        if (!firebaseInitialized) return;
        
        try {
            const commentRef = doc(db, "kommentare", commentId);
            await updateDoc(commentRef, updates);
        } catch (error) {
            console.error("Fehler beim Aktualisieren:", error);
            showNotification("❌ Fehler beim Aktualisieren", "error");
        }
    }

    function formatDate(timestamp) {
        if (!timestamp) return "gerade eben";
        
        const date = timestamp.toDate ? timestamp.toDate() : new Date(timestamp);
        const now = new Date();
        const diffMs = now - date;
        const diffMins = Math.floor(diffMs / 60000);
        const diffHours = Math.floor(diffMs / 3600000);
        const diffDays = Math.floor(diffMs / 86400000);
        
        if (diffMins < 1) return "gerade eben";
        if (diffMins < 60) return `vor ${diffMins} Min`;
        if (diffHours < 24) return `vor ${diffHours} Std`;
        if (diffDays < 30) return `vor ${diffDays} Tag${diffDays > 1 ? 'en' : ''}`;
        
        return date.toLocaleDateString('de-DE');
    }

    function showLoading(show) {
        const existingLoader = document.getElementById('comments-loader');
        
        if (show && !existingLoader) {
            const loader = document.createElement('div');
            loader.id = 'comments-loader';
            loader.style.cssText = `
                text-align: center;
                padding: 40px;
                color: #6c757d;
                font-size: 1.1em;
            `;
            loader.innerHTML = `
                <div style="display: inline-block; animation: spin 1s linear infinite;">🔄</div>
                <div style="margin-top: 10px;">Kommentare werden geladen...</div>
            `;
            
            const commentsList = document.getElementById('comments-list');
            commentsList.appendChild(loader);
            
            // CSS für Spinner
            if (!document.getElementById('spinner-style')) {
                const style = document.createElement('style');
                style.id = 'spinner-style';
                style.textContent = `
                    @keyframes spin {
                        0% { transform: rotate(0deg); }
                        100% { transform: rotate(360deg); }
                    }
                `;
                document.head.appendChild(style);
            }
        } else if (!show && existingLoader) {
            existingLoader.remove();
        }
    }

    // Globale Variablen für die normale Script-Umgebung
    window.firebaseInitialized = firebaseInitialized;
    window.loadCommentsFromFirebase = loadCommentsFromFirebase;
    window.saveCommentToFirebase = saveCommentToFirebase;
    window.updateCommentInFirebase = updateCommentInFirebase;
</script>

<script>
    function formatCurrency(amount) {
        return new Intl.NumberFormat('de-DE', {
            style: 'currency',
            currency: 'EUR',
            minimumFractionDigits: 0,
            maximumFractionDigits: 0
        }).format(amount);
    }

    function formatPercent(rate) {
        return (rate).toFixed(1) + '%';
    }

    function berechnen() {
        // Eingabewerte erfassen
        const kaufpreis = parseFloat(document.getElementById('kaufpreis').value) || 0;
        const verkaufspreis = parseFloat(document.getElementById('verkaufspreis').value) || 0;
        const nebenkostenKauf = parseFloat(document.getElementById('nebenkosten_kauf').value) || 0;
        const nebenkostenVerkauf = parseFloat(document.getElementById('nebenkosten_verkauf').value) || 0;
        const modernisierung = parseFloat(document.getElementById('modernisierung').value) || 0;
        const haltedauer = parseFloat(document.getElementById('haltedauer').value) || 0;
        const persSteuersatz = parseFloat(document.getElementById('persoenlicher_steuersatz').value) || 0;
        const kirchensteuer = parseFloat(document.getElementById('kirchensteuer').value) || 0;

        // Grundberechnungen
        const gesamtkosten = kaufpreis + nebenkostenKauf + modernisierung;
        const bruttogewinn = verkaufspreis - nebenkostenVerkauf - gesamtkosten;

        // Konstanten definieren
        const koerperschaftsteuer = 15;
        const soli = 5.5;
        const gesamtsteuersatz = persSteuersatz + (persSteuersatz * kirchensteuer / 100) + (persSteuersatz * soli / 100);
        const einbringungNach = parseFloat(document.getElementById('einbringung_nach_jahren').value) || 0;
        
        // Alle Strukturen berechnen
        const ergebnisse = [];

        // 1. Privatverkauf
        let steuer = 0;
        let steuerfrei = false;
        if (haltedauer >= 10) {
            steuerfrei = true;
            steuer = 0;
        } else {
            steuer = bruttogewinn * gesamtsteuersatz / 100;
        }
        ergebnisse.push({
            typ: 'Privatverkauf',
            bruttogewinn: bruttogewinn,
            steuer: steuer,
            nettogewinn: bruttogewinn - steuer,
            besonderheiten: steuerfrei ? 'Steuerfrei nach 10 Jahren' : 'Spekulationssteuer'
        });

        // 2. VV GbR
        ergebnisse.push({
            typ: 'VV GbR',
            bruttogewinn: bruttogewinn,
            steuer: steuer, // Gleich wie Privatverkauf
            nettogewinn: bruttogewinn - steuer,
            besonderheiten: steuerfrei ? 'Steuerfrei nach 10 Jahren (wie Privatverkauf)' : 'Transparente Besteuerung, Spekulationssteuer'
        });

        // 3. Gewerbliche GbR - KEINE 10-Jahres-Frist (gewerblich = Betriebseinnahmen)
        const gewerbesteuer = 14;
        const gewerbesteuerFreibetrag = 24500;
        const gewerbesteuerBasis = Math.max(0, bruttogewinn - gewerbesteuerFreibetrag);
        const gewerbesteuerBetrag = gewerbesteuerBasis * gewerbesteuer / 100;
        const anrechnungsbetrag = gewerbesteuerBetrag * 3.8;
        const einkommensteuerBasis = bruttogewinn - Math.min(anrechnungsbetrag, gewerbesteuerBetrag);
        const einkommensteuer = einkommensteuerBasis * gesamtsteuersatz / 100;
        const gesamtsteuerGewGbr = gewerbesteuerBetrag + einkommensteuer;

        ergebnisse.push({
            typ: 'Gewerbliche GbR',
            bruttogewinn: bruttogewinn,
            steuer: gesamtsteuerGewGbr,
            nettogewinn: bruttogewinn - gesamtsteuerGewGbr,
            besonderheiten: 'Gewerblich = KEINE 10-Jahres-Frist (§23 EStG gilt nicht bei Betriebseinnahmen)'
        });

        // 4. VV GmbH - Verkauf durch GmbH (nach Einbringung)
        const gstBasisVV = Math.max(0, bruttogewinn - gewerbesteuerFreibetrag);
        const gstBetragVV = gstBasisVV * gewerbesteuer / 100;
        const kstBasisVV = bruttogewinn - gstBetragVV;
        const kstBetragVV = kstBasisVV * koerperschaftsteuer / 100;
        const soliVV = kstBetragVV * 5.5 / 100;
        const gesamtsteuerVV = gstBetragVV + kstBetragVV + soliVV;
        const nettoGewinnGmbhVV = bruttogewinn - gesamtsteuerVV;
        const abgeltungsteuerVV = nettoGewinnGmbhVV * 26.375 / 100;
        
        let besonderheitVV = '❌ NIEMALS steuerfrei! Doppelbesteuerung: ~30% GmbH + ~26% Ausschüttung';
        if (einbringungNach > 0 && einbringungNach >= 10) {
            besonderheitVV = `✅ Einbringung nach ${einbringungNach} Jahren war steuerfrei, ❌ aber Verkauf durch GmbH = Doppelbesteuerung`;
        } else if (einbringungNach > 0) {
            besonderheitVV = `❌ Einbringung nach ${einbringungNach} Jahren war steuerpflichtig, Verkauf auch = Doppelbesteuerung`;
        }
        
        ergebnisse.push({
            typ: 'VV GmbH',
            bruttogewinn: bruttogewinn,
            steuer: gesamtsteuerVV + abgeltungsteuerVV,
            nettogewinn: nettoGewinnGmbhVV - abgeltungsteuerVV,
            besonderheiten: besonderheitVV
        });

        // 5. Gewerbliche GmbH  
        const gstBetragGew = bruttogewinn * gewerbesteuer / 100;
        const kstBasisGew = bruttogewinn - gstBetragGew;
        const kstBetragGew = kstBasisGew * koerperschaftsteuer / 100;
        const soliGew = kstBetragGew * 5.5 / 100;
        const gesamtsteuerGew = gstBetragGew + kstBetragGew + soliGew;
        const nettoGewinnGmbhGew = bruttogewinn - gesamtsteuerGew;
        const abgeltungsteuerGew = nettoGewinnGmbhGew * 26.375 / 100;
        
        ergebnisse.push({
            typ: 'Gewerbliche GmbH',
            bruttogewinn: bruttogewinn,
            steuer: gesamtsteuerGew + abgeltungsteuerGew,
            nettogewinn: nettoGewinnGmbhGew - abgeltungsteuerGew,
            besonderheiten: 'KEINE § 8b KStG Teilfreistellung bei gewerblicher Tätigkeit!'
        });

        // 6. VV GmbH & Co. KG - Transparente Besteuerung, 10-Jahres-Frist gilt, NEU: Gewerbesteuerbefreiung
        if (haltedauer >= 10) {
            ergebnisse.push({
                typ: 'VV GmbH & Co. KG',
                bruttogewinn: bruttogewinn,
                steuer: 0,
                nettogewinn: bruttogewinn,
                besonderheiten: '🏆 STEUERFREI nach 10 Jahren + BFH 2025: Gewerbesteuerbefreiung für "aufwärts abgefärbte" Strukturen!'
            });
        } else {
            // NEU: Gewerbesteuerbefreiung für rein vermögensverwaltende "aufwärts abgefärbte" Strukturen
            const steuerVVKGOhneGewSt = bruttogewinn * gesamtsteuersatz / 100;
            ergebnisse.push({
                typ: 'VV GmbH & Co. KG',
                bruttogewinn: bruttogewinn,
                steuer: steuerVVKGOhneGewSt,
                nettogewinn: bruttogewinn - steuerVVKGOhneGewSt,
                besonderheiten: '⭐ BFH 2025: GEWERBESTEUERFREI als "aufwärts abgefärbte" Struktur + wird nach 10 Jahren komplett steuerfrei!'
            });
        }

        // 7. Gewerbliche GmbH & Co. KG - KEINE 10-Jahres-Frist (gewerblich)
        ergebnisse.push({
            typ: 'Gew. GmbH & Co. KG',
            bruttogewinn: bruttogewinn,
            steuer: gesamtsteuerGewGbr,
            nettogewinn: bruttogewinn - gesamtsteuerGewGbr,
            besonderheiten: 'Gewerblich = KEINE 10-Jahres-Frist, aber Gewerbesteueranrechnung'
        });

        // 8. VV UG - Verkauf durch UG (nach Einbringung)
        const gstBasisUG = Math.max(0, bruttogewinn - gewerbesteuerFreibetrag);
        const gstBetragUG = gstBasisUG * gewerbesteuer / 100;
        const kstBasisUG = bruttogewinn - gstBetragUG;
        const kstBetragUG = kstBasisUG * koerperschaftsteuer / 100;
        const soliUG = kstBetragUG * 5.5 / 100;
        const gesamtsteuerUG = gstBetragUG + kstBetragUG + soliUG;
        const nettoGewinnUG = bruttogewinn - gesamtsteuerUG;
        
        const thesaurierungsbedarf = Math.max(0, 25000 - 1);
        const thesaurierung = Math.min(nettoGewinnUG * 0.25, thesaurierungsbedarf);
        const ausschuettbareGewinnUG = nettoGewinnUG - thesaurierung;
        const abgeltungsteuerUG = ausschuettbareGewinnUG * 26.375 / 100;
        
        let besonderheitUG = '❌ NIEMALS steuerfrei! Doppelbesteuerung + 25% Thesaurierungspflicht';
        if (einbringungNach > 0 && einbringungNach >= 10) {
            besonderheitUG = `✅ Einbringung nach ${einbringungNach} Jahren war steuerfrei, ❌ aber Verkauf durch UG = Doppelbesteuerung + Thesaurierung`;
        } else if (einbringungNach > 0) {
            besonderheitUG = `❌ Einbringung nach ${einbringungNach} Jahren war steuerpflichtig, Verkauf auch = Doppelbesteuerung + Thesaurierung`;
        }
            
        ergebnisse.push({
            typ: 'VV UG',
            bruttogewinn: bruttogewinn,
            steuer: gesamtsteuerUG + abgeltungsteuerUG,
            nettogewinn: ausschuettbareGewinnUG - abgeltungsteuerUG + thesaurierung,
            besonderheiten: besonderheitUG
        });

        // Ergebnisse anzeigen
        zeigeErgebnisse(ergebnisse);
    }

    function zeigeErgebnisse(ergebnisse) {
        const resultsGrid = document.getElementById('results-grid');
        const comparisonTable = document.getElementById('comparison-table');
        const comparisonBody = document.getElementById('comparison-body');

        // Beste Option ermitteln
        const besteOption = ergebnisse.reduce((beste, aktuelle) => 
            aktuelle.nettogewinn > beste.nettogewinn ? aktuelle : beste
        );

        // Ergebniskarten erstellen
        resultsGrid.innerHTML = '';
        
        ergebnisse.forEach(option => {
            const isBest = option.typ === besteOption.typ;
            const card = document.createElement('div');
            card.className = `result-card ${isBest ? 'best-option' : ''}`;
            
            card.innerHTML = `
                <h3>${option.typ} ${isBest ? '🏆' : ''}</h3>
                <div class="result-item">
                    <span class="result-label">Bruttogewinn:</span>
                    <span class="result-value">${formatCurrency(option.bruttogewinn)}</span>
                </div>
                <div class="result-item">
                    <span class="result-label">Steuern gesamt:</span>
                    <span class="result-value negative">${formatCurrency(option.steuer)}</span>
                </div>
                <div class="result-item">
                    <span class="result-label">Nettogewinn:</span>
                    <span class="result-value">${formatCurrency(option.nettogewinn)}</span>
                </div>
                <div style="margin-top: 15px; padding: 10px; background: #f8f9fa; border-radius: 8px; font-size: 0.9em; color: #6c757d;">
                    ${option.besonderheiten}
                </div>
            `;
            
            resultsGrid.appendChild(card);
        });

        // Vergleichstabelle aktualisieren
        comparisonBody.innerHTML = '';
        ergebnisse.forEach(option => {
            const isBest = option.typ === besteOption.typ;
            const row = document.createElement('tr');
            if (isBest) row.className = 'best-option';
            
            row.innerHTML = `
                <td><strong>${option.typ}</strong></td>
                <td>${formatCurrency(option.nettogewinn)}</td>
                <td>${formatCurrency(option.steuer)}</td>
                <td>${formatPercent(option.steuer / option.bruttogewinn * 100)}</td>
                <td style="font-size: 0.8em;">${option.besonderheiten}</td>
            `;
            
            comparisonBody.appendChild(row);
        });

        comparisonTable.style.display = 'table';
    }

    // Initiale Berechnung beim Laden
    window.onload = function() {
        berechnen();
    };

    // Automatische Neuberechnung bei Eingabeänderungen
    document.querySelectorAll('input').forEach(input => {
        input.addEventListener('input', berechnen);
    });

    // Kommentarfunktionalität mit Firebase Integration
    let comments = [];
    let userLikes = {}; // Speichert welche Kommentare der User geliked/disliked hat

    // Fallback Default-Kommentare (wenn Firebase nicht verfügbar)
    function getDefaultComments() {
        return [
            {
                id: 1,
                author: "Max Immobilien",
                content: "Sehr hilfreiches Tool! Die Unterscheidung zwischen Einbringung und Verkauf war mir so nicht bewusst. Besonders der Hinweis zur VV GmbH & Co. KG ist wertvoll. Hat mir bei der Entscheidung für meine Immobilienstrategie geholfen.",
                date: "vor 2 Tagen",
                likes: 12,
                dislikes: 1,
                avatar: "👤",
                replies: [
                    {
                        id: "1-1",
                        author: "Steuerberaterin Sarah",
                        content: "@Max Immobilien Genau richtig erkannt! Die BFH-Urteile von 2024/2025 haben hier einiges geändert. Wichtig ist auch die neue Rechtsprechung zu Gesellschafterdarlehen.",
                        date: "vor 1 Tag",
                        likes: 8,
                        dislikes: 0,
                        avatar: "👩‍💼"
                    }
                ]
            },
            {
                id: 2,
                author: "Investor_2024",
                content: "Eine Frage zur Berechnung: Werden auch die neuen Regelungen zur Grundsteuer berücksichtigt? Und wie sieht es mit der Erbschaftsteuer bei Übertragung aus?",
                date: "vor 5 Tagen",
                likes: 5,
                dislikes: 2,
                avatar: "🏠",
                replies: []
            },
            {
                id: 3,
                author: "Rechtsanwalt Weber",
                content: "Wichtiger Hinweis zum Tool: Bei der Drei-Objekt-Grenze gibt es seit 2024 verschärfte Prüfungen durch die Finanzämter. Jeder Fall wird einzeln betrachtet. Das Tool ist aber eine super Orientierungshilfe für erste Kalkulationen.",
                date: "vor 1 Woche",
                likes: 18,
                dislikes: 0,
                avatar: "⚖️",
                replies: []
            }
        ];
    }

    // Lokaler Fallback für Kommentarspeicherung
    function saveCommentLocally(comment) {
        const localComments = JSON.parse(localStorage.getItem('steuervergleich-kommentare') || '[]');
        comment.id = Date.now().toString();
        localComments.unshift(comment);
        localStorage.setItem('steuervergleich-kommentare', JSON.stringify(localComments));
        return comment.id;
    }

    function loadCommentsLocally() {
        const localComments = JSON.parse(localStorage.getItem('steuervergleich-kommentare') || '[]');
        return localComments.length > 0 ? localComments : getDefaultComments();
    }

    // Kommentare laden (Firebase oder lokal)
    async function loadComments() {
        try {
            if (window.firebaseInitialized) {
                comments = await window.loadCommentsFromFirebase();
            } else {
                comments = loadCommentsLocally();
            }
            
            if (comments.length === 0) {
                comments = getDefaultComments();
            }
            
            renderComments();
        } catch (error) {
            console.error("Fehler beim Laden der Kommentare:", error);
            comments = getDefaultComments();
            renderComments();
        }
    }

    // Zeichenzähler für Kommentarfeld
    const commentText = document.getElementById('comment-text');
    const charCount = document.getElementById('char-count');
    
    commentText.addEventListener('input', function() {
        const count = this.value.length;
        charCount.textContent = count;
        
        if (count > 900) {
            charCount.style.color = '#e74c3c';
        } else if (count > 800) {
            charCount.style.color = '#f39c12';
        } else {
            charCount.style.color = '#6c757d';
        }
    });

    // Kommentar hinzufügen (Firebase oder lokal)
    document.getElementById('submit-comment').addEventListener('click', async function() {
        const authorName = document.getElementById('author-name').value.trim();
        const commentContent = document.getElementById('comment-text').value.trim();
        
        if (!authorName || !commentContent) {
            showNotification('❌ Bitte füllen Sie beide Felder aus.', 'error');
            return;
        }
        
        if (commentContent.length > 1000) {
            showNotification('❌ Der Kommentar ist zu lang. Maximal 1000 Zeichen erlaubt.', 'error');
            return;
        }
        
        // Button deaktivieren während des Speicherns
        const submitBtn = this;
        const originalText = submitBtn.innerHTML;
        submitBtn.disabled = true;
        submitBtn.innerHTML = '⏳ Wird gespeichert...';
        
        try {
            const newComment = {
                author: authorName,
                content: commentContent,
                date: "gerade eben",
                likes: 0,
                dislikes: 0,
                avatar: getRandomAvatar(),
                replies: []
            };
            
            if (window.firebaseInitialized) {
                // Firebase speichern
                const commentId = await window.saveCommentToFirebase(newComment);
                newComment.id = commentId;
            } else {
                // Lokal speichern
                newComment.id = saveCommentLocally(newComment);
            }
            
            comments.unshift(newComment);
            renderComments();
            
            // Formular zurücksetzen
            document.getElementById('author-name').value = '';
            document.getElementById('comment-text').value = '';
            charCount.textContent = '0';
            charCount.style.color = '#6c757d';
            
            showNotification('✅ Kommentar wurde erfolgreich hinzugefügt!', 'success');
            
        } catch (error) {
            console.error("Fehler beim Speichern:", error);
            showNotification('❌ Fehler beim Speichern des Kommentars. Versuchen Sie es erneut.', 'error');
        } finally {
            // Button wieder aktivieren
            submitBtn.disabled = false;
            submitBtn.innerHTML = originalText;
        }
    });

    function getRandomAvatar() {
        const avatars = ['👤', '👨‍💼', '👩‍💼', '🏠', '💰', '📈', '⚖️', '🔍', '💡', '📊'];
        return avatars[Math.floor(Math.random() * avatars.length)];
    }

    function showNotification(message, type = 'info') {
        const notification = document.createElement('div');
        const bgColor = type === 'success' ? '#27ae60' : type === 'error' ? '#e74c3c' : '#3498db';
        
        notification.style.cssText = `
            position: fixed;
            top: 20px;
            right: 20px;
            background: ${bgColor};
            color: white;
            padding: 15px 20px;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
            z-index: 1000;
            font-weight: 600;
            animation: slideIn 0.3s ease;
            max-width: 300px;
        `;
        notification.textContent = message;
        document.body.appendChild(notification);
        
        setTimeout(() => {
            notification.style.animation = 'slideOut 0.3s ease';
            setTimeout(() => {
                if (notification.parentNode) {
                    document.body.removeChild(notification);
                }
            }, 300);
        }, 4000);
    }

    // CSS Animation für Benachrichtigungen
    const style = document.createElement('style');
    style.textContent = `
        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        @keyframes slideOut {
            from { transform: translateX(0); opacity: 1; }
            to { transform: translateX(100%); opacity: 0; }
        }
    `;
    document.head.appendChild(style);

    function renderComments() {
        const commentsList = document.getElementById('comments-list');
        const commentCount = document.getElementById('comment-count');
        
        commentCount.textContent = comments.length;
        
        // Entferne nur die Kommentare, behalte den Counter
        const existingComments = commentsList.querySelectorAll('.comment');
        existingComments.forEach(comment => comment.remove());
        
        comments.forEach(comment => {
            const commentElement = createCommentElement(comment);
            commentsList.appendChild(commentElement);
        });
    }

    function createCommentElement(comment) {
        const commentDiv = document.createElement('div');
        commentDiv.className = 'comment';
        commentDiv.setAttribute('data-id', comment.id);
        
        const repliesHtml = (comment.replies || []).map(reply => `
            <div class="reply" data-id="${reply.id}">
                <div class="comment-header">
                    <div class="comment-avatar">${reply.avatar}</div>
                    <div class="comment-meta">
                        <strong class="comment-author">${reply.author}</strong>
                        <span class="comment-date">${reply.date}</span>
                    </div>
                </div>
                <div class="comment-content">${reply.content}</div>
                <div class="comment-actions">
                    <button class="like-btn" data-likes="${reply.likes}" data-comment-id="${reply.id}">
                        👍 <span>${reply.likes}</span>
                    </button>
                    <button class="dislike-btn" data-dislikes="${reply.dislikes}" data-comment-id="${reply.id}">
                        👎 <span>${reply.dislikes}</span>
                    </button>
                </div>
            </div>
        `).join('');
        
        commentDiv.innerHTML = `
            <div class="comment-header">
                <div class="comment-avatar">${comment.avatar}</div>
                <div class="comment-meta">
                    <strong class="comment-author">${comment.author}</strong>
                    <span class="comment-date">${comment.date}</span>
                </div>
            </div>
            <div class="comment-content">${comment.content}</div>
            <div class="comment-actions">
                <button class="like-btn ${userLikes[comment.id] === 'like' ? 'active' : ''}" data-likes="${comment.likes}" data-comment-id="${comment.id}">
                    👍 <span>${comment.likes}</span>
                </button>
                <button class="dislike-btn ${userLikes[comment.id] === 'dislike' ? 'active' : ''}" data-dislikes="${comment.dislikes}" data-comment-id="${comment.id}">
                    👎 <span>${comment.dislikes}</span>
                </button>
                <button class="reply-btn" data-comment-id="${comment.id}">💬 Antworten</button>
            </div>
            <div class="reply-form" id="reply-form-${comment.id}">
                <input type="text" placeholder="Ihr Name" id="reply-author-${comment.id}" maxlength="50">
                <textarea placeholder="Ihre Antwort..." id="reply-content-${comment.id}" rows="3" maxlength="500"></textarea>
                <button onclick="submitReply('${comment.id}')">Antworten</button>
                <button class="cancel-btn" onclick="cancelReply('${comment.id}')">Abbrechen</button>
            </div>
            <div class="replies">
                ${repliesHtml}
            </div>
        `;
        
        return commentDiv;
    }

    // Event-Delegation für Like/Dislike Buttons
    document.addEventListener('click', function(e) {
        if (e.target.matches('.like-btn') || e.target.closest('.like-btn')) {
            const btn = e.target.closest('.like-btn');
            handleLikeDislike(btn, 'like');
        } else if (e.target.matches('.dislike-btn') || e.target.closest('.dislike-btn')) {
            const btn = e.target.closest('.dislike-btn');
            handleLikeDislike(btn, 'dislike');
        } else if (e.target.matches('.reply-btn') || e.target.closest('.reply-btn')) {
            const btn = e.target.closest('.reply-btn');
            const commentId = btn.getAttribute('data-comment-id');
            toggleReplyForm(commentId);
        }
    });

    async function handleLikeDislike(button, action) {
        const commentId = button.getAttribute('data-comment-id');
        const currentUserAction = userLikes[commentId];
        
        // Finde den Kommentar oder die Antwort
        let targetComment = comments.find(c => c.id == commentId);
        if (!targetComment) {
            // Suche in Antworten
            for (let comment of comments) {
                const reply = comment.replies.find(r => r.id == commentId);
                if (reply) {
                    targetComment = reply;
                    break;
                }
            }
        }
        
        if (!targetComment) return;
        
        // Aktualisiere die Werte
        const oldLikes = targetComment.likes;
        const oldDislikes = targetComment.dislikes;
        
        if (currentUserAction === action) {
            // Gleiche Aktion wieder - entfernen
            if (action === 'like') {
                targetComment.likes--;
            } else {
                targetComment.dislikes--;
            }
            delete userLikes[commentId];
        } else {
            // Neue Aktion oder Wechsel
            if (currentUserAction === 'like') {
                targetComment.likes--;
            } else if (currentUserAction === 'dislike') {
                targetComment.dislikes--;
            }
            
            if (action === 'like') {
                targetComment.likes++;
            } else {
                targetComment.dislikes++;
            }
            userLikes[commentId] = action;
        }
        
        // Firebase Update (nur für Hauptkommentare, nicht Antworten)
        if (window.firebaseInitialized && !commentId.includes('-')) {
            try {
                await window.updateCommentInFirebase(commentId, {
                    likes: targetComment.likes,
                    dislikes: targetComment.dislikes
                });
            } catch (error) {
                // Revert bei Fehler
                targetComment.likes = oldLikes;
                targetComment.dislikes = oldDislikes;
                showNotification('❌ Fehler beim Aktualisieren', 'error');
            }
        }
        
        renderComments();
    }

    function toggleReplyForm(commentId) {
        const replyForm = document.getElementById(`reply-form-${commentId}`);
        if (replyForm.classList.contains('active')) {
            replyForm.classList.remove('active');
        } else {
            // Schließe alle anderen Reply-Forms
            document.querySelectorAll('.reply-form.active').forEach(form => {
                form.classList.remove('active');
            });
            replyForm.classList.add('active');
            document.getElementById(`reply-author-${commentId}`).focus();
        }
    }

    async function submitReply(commentId) {
        const authorInput = document.getElementById(`reply-author-${commentId}`);
        const contentInput = document.getElementById(`reply-content-${commentId}`);
        
        const author = authorInput.value.trim();
        const content = contentInput.value.trim();
        
        if (!author || !content) {
            showNotification('❌ Bitte füllen Sie beide Felder aus.', 'error');
            return;
        }
        
        const reply = {
            id: `${commentId}-${Date.now()}`,
            author: author,
            content: content,
            date: "gerade eben",
            likes: 0,
            dislikes: 0,
            avatar: getRandomAvatar()
        };
        
        const comment = comments.find(c => c.id == commentId);
        if (comment) {
            comment.replies.push(reply);
            
            // Firebase Update für Antworten
            if (window.firebaseInitialized) {
                try {
                    await window.updateCommentInFirebase(commentId, {
                        replies: comment.replies
                    });
                } catch (error) {
                    showNotification('❌ Fehler beim Speichern der Antwort', 'error');
                    comment.replies.pop(); // Entferne die Antwort wieder
                    return;
                }
            }
            
            renderComments();
            showNotification('✅ Antwort wurde hinzugefügt!', 'success');
            
            // Formular zurücksetzen
            authorInput.value = '';
            contentInput.value = '';
            toggleReplyForm(commentId);
        }
    }

    function cancelReply(commentId) {
        const replyForm = document.getElementById(`reply-form-${commentId}`);
        replyForm.classList.remove('active');
        
        // Felder leeren
        document.getElementById(`reply-author-${commentId}`).value = '';
        document.getElementById(`reply-content-${commentId}`).value = '';
    }

    // Kommentare beim Laden der Seite laden
    loadComments();
</script>
```

</body>
</html>
